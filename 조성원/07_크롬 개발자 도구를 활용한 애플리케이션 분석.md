# 1. 크롬 개발자 도구란?

- 크롬에서 제공하는 개발자용 도구
- 웹페이지에서 일어나는 거의 모든 일을 확인할 수 있는 강력한 개발 도구

> **개인정보 보호 모드에서의 사용을 권장**  
> 브라우저 확장 프로그램이 웹페이지 방문 시 확장 프로그램의 실행을 위해 전역 변수나 HTML 요소에 실제 웹 애플리케이션이 제공하지 않은 다른 정보를 추가할 수 있다. 이러한 정보는 개발자가 추가한 정보가 아닐뿐더러 다른 사용자에게서는 볼 수 없는 정보로서 디버깅하는 데 방해가 될 수 있다.  
> 개인정보 보호 모드에서는 **확장 프로그램이 실행되지 않기 때문에** 순수하게 웹페이지와 관련된 정보만 확인할 수 있다.

&nbsp;

# 2. 요소 탭

- 웹페이지를 구성하고 있는 HTML, CSS 등의 정보를 확인할 수 있다.
- 왼쪽에는 현재 웹페이지의 HTML 트리, 오른쪽에는 왼쪽에서 선택한 요소와 관련된 각종 정보가 표시된다.

## 1. 요소 화면

- HTML을 수정해서 웹페이지에서 어떻게 보이는지 빠르게 확인할 수 있다. (태그명, 클래스, 스타일 등)
- 리액트 코드를 수정해 핫 리로딩을 거치지 않아도 확인할 수 있으므로 빠른 작업이 가능하다.
- 코드에 의해 클래스나 속성값이 동적으로 제어되는 DOM의 경우 요소의 중단점을 사용해 디버깅할 수 있다. (우클릭 - 중단위치)

## 2. 요소 정보

- **스타일:** 요소의 스타일 정보. 어떤 클래스, 태그명, 아이디 등으로 매핑되어 설정된 스타일인지 확인할 수 있다. 수정해 페이지에 어떻게 반영되는지 미리 확인해볼 수 있다.
- **계산됨:** 해당 요소의 크기, 패딩, 보더, 마진과 각종 CSS 적용 결괏값을 알 수 있는 탭. 적용된 스타일이 결과적으로 어떤 결과물로 나타나는지 확인할 수 있다.
- **레이아웃:** CSS 그리드나 레이아웃과 관련된 정보를 확인할 수 있다.
- **이벤트 리스너:** 현재 요소에 부착된 각종 이벤트 리스너를 확인할 수 있다. 이벤트 버블링 등으로 이벤트를 발생시키는 경우에는 확인할 수 없다.
- **DOM 중단점:** 중단점이 있는지 알려주는 탭
- **속성:** 해당 요소가 가지고 있는 모든 속성값을 나타낸다.
- **접근성:** 스크린리더기 등이 활용하는 값에 대한 정보를 확인할 수 있다.

&nbsp;

# 3. 소스 탭

- 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있다.
- 디버깅하고 싶은 파일을 직접 열어야 한다. (개발 모드에서 용이하게 사용 가능)
- 소스 중단점을 생성해 자바스크립트 실행을 중단시키고 디버깅을 수행할 수 있다.

- **감시:** 감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있는 메뉴. 확인할 수 없는 값은 `<not available>`로 표시된다.
- **중단점:** 현재 웹사이트에서 추가된 중단점을 확인할 수 있다.
- **범위:** 현재 중단점에서의 스코프에서 접근할 수 있는 값을 확인할 수 있다. (클로저, 전역 스코프 등)
- **호출 스택:** 현재 중단점의 콜스택을 확인할 수 있다.
- **전역 리스너:** 전역 스코프에 추가된 리스너 목록을 확인할 수 있다.
- **XHR/가져오기, DOM, 이벤트리스너, CSP 위반 중단점:** 소스의 중단점 이외에 다양한 중단점을 확인할 수 있다.

&nbsp;

# 4. 네트워크 탭

- 웹페이지에 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.
- HTTP 요청부터 웹 소켓 등 웹페이지가 외부 데이터와 통신하는 정보를 확인할 수 있다.
- 하단에는 페이지를 불러오는 기간 동안 발생한 총 요청 건수와 총 다운로드한 업로드 리소스의 크기를 확인할 수 있다.

1. 불필요한 요청 또는 중복되는 요청이 없는지
   - 잘못된 `useEffect`의 사용으로 요청이 두 번 실행되는 등의 문제를 발견할 수 있다.
2. 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
   - 리소스 크기가 크다면 `gzip`, `brotli` 등을 활용해 리소스를 압축하거나 이미지를 최적화할 필요가 있다.
3. 리소스를 불러오는 속도는 적절한지 또는 너무 속도가 오래 걸리는 리소스는 없는지
4. 리소스가 올바른 우선수위로 다운로드되어 페이지를 자연스럽게 만들어가는지

&nbsp;

# 5. 메모리 탭

- 웹페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.
- 크롬 개발자 도구에서 제공하는 도구 중 가장 난이도가 높고 까다롭다.

- 힙 스냅샷: 현재 메모리 상황을 사진 찍듯이 촬영할 수 있다.
- 타임라인의 할당 계측: 시간의 흐름에 따라 메모리의 변화를 살펴보고 싶을 때 사용한다. 주로 로딩이 되는 과정의 메모리 변화 또는 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용한다.
- 할당 샘플링: 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

## 1. 자바스크립트 인스턴스 VM 선택

- 현재 실행중인 자바스크립트 VM 인스턴스를 확인할 수 있다.
- 환경별 힙 크기를 볼 수 있는데, 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.
  - 자바스크립트 실행에 따라 실시간으로 변경된다.
  - 불필요하게 크기가 늘어나지 않는지 눈여겨볼 필요가 있다.

## 2. 힙 스냅샷

- 메모리 누수를 찾을 대는 얕은 크기는 작으나 유지된 크기가 큰 객체를 찾아야 한다.
- 두 크기의 차이가 큰 객체는 다수의 다른 객체를 참조하고 있다는 뜻 (복잡한 참조 관계)
- 의심이 되는 지점을 먼저 추측해 본 뒤에 두 개 이상의 스냅샷을 촬영해 그 차이를 비교하는 것이 수월하다.
  - `useMemo`나 `useCallback`과 같은 의존성이 있는 값들이 정말로 렌더링 사이에 그대로 유지되는지 확인할 수 있다.
- 디버깅을 원활하게 하려면 기명 함수를 사용하자!

## 3. 타임라인 할당 계측

- 시간의 흐름에 따라 메모리의 변화를 모두 기록하기 때문에 상대적으로 많은 부담이 발생
- 메모리 변화를 일으킨 변수가 무엇인지, 해당 변수가 어느정도 크기를 차지하고 있는지 등을 확인할 수 있다.
  - 특정 변수를 클릭해서 전역 변수로 저장을 누르면 해당 변수가 무슨 값을 가지고 잇는 객체인지 콘솔에서 확인할 수 있다.

## 4. 할당 샘플링

- 자바스크립트 실행 스택별로 분석할 수 있다.
- 타임라인 할당 계측에 비해 브라우저에 주는 부담을 최소화할 수 있어 장시간 디버깅에 유리하다.

&nbsp;

# 6. Next.js 환경 디버깅하기

## 1. Next.js 프로젝트를 디버그 모드로 실행

1. `"dev": NODE_OPTIONS='--inspect' next dev`
2. 크롬 주소창에 `chrome://inspect`
3. Open dedicated DevTools for Node

## 2. Next.js 서버에 트래픽 유입시키기

-`ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"`

- **ab:** 아파치 재단에서 제공하는 웹서버 성능 검사 도구로, 50개의 요청을 총 10000회 시도한다는 의미이다.
- `localhost`는 정상적으로 실행되지 않으니 반드시 IP나 올바른 주소를 기재해야 한다.

## 3. Next.js의 메모리 누수 지점 확인하기

[FEConf 2023 [B2] SSR 환경(Node.js) 메모리 누수 디버깅 가이드](https://www.youtube.com/watch?v=P3C7fzMqIYg&t=277s)
